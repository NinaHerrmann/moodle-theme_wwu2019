{"version":3,"sources":["../src/menu.js"],"names":["init","openMenu","updateMaxMenuHeight","window","resize","mainMenu","botPos","offset","top","outerHeight","css","height","openCandidate","openTimeoutId","closeTimeoutId","openTime","open","menuItem","close","abortClose","addClass","attr","openWithDelay","setTimeout","Date","removeClass","closeWithDelay","clearTimeout","abortOpen","click","ev","currentTarget","parentNode","menuitems","mouseenter","mouseleave","node","toggleClass"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the user menu.\n *\n * @package    theme_wwu2019\n * @copyright  2019 Justus Dieckmann WWU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\n/**\n * Init function\n */\nexport function init() {\n    openMenu();\n\n    updateMaxMenuHeight();\n    $(window).resize(updateMaxMenuHeight);\n}\n\n/**\n * Updates max-height of submenus on page-init and window resize.\n */\nfunction updateMaxMenuHeight() {\n    const mainMenu = $('#main-menu');\n    const botPos = mainMenu.offset().top + mainMenu.outerHeight() + 16;\n    $('.sub-menu-scroll-container').css('max-height', ($(window).height() - botPos) + 'px');\n}\n\n/**\n * Opens submenu when hovering\n */\nfunction openMenu() {\n    const openDelay = 100;\n    const closeDelay = 300;\n    const closeCooldown = 300;\n\n    let openMenu = null;\n    let openCandidate = null;\n    let openTimeoutId = null;\n    let closeTimeoutId = null;\n    /** Date when menu was opened by hovering, to prevent immediately closing it by clicking again.\n     * @type {null|Date} */\n    let openTime = null;\n\n    /**\n     * Opens a menu.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function open(menuItem) {\n        if (openMenu) {\n            close(openMenu);\n        }\n        abortClose();\n        $(menuItem).addClass('open');\n        $(menuItem).attr('aria-expanded', 'true');\n        openMenu = menuItem;\n        openCandidate = null;\n        openTimeoutId = null;\n    }\n\n    /**\n     * Opens a menu with delay.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function openWithDelay(menuItem) {\n        openCandidate = menuItem;\n        openTimeoutId = setTimeout(() => {\n            open(menuItem);\n            openTime = new Date();\n        }, openDelay);\n    }\n\n    /**\n     * Closes a menu.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function close(menuItem) {\n        $(menuItem).removeClass('open');\n        $(menuItem).attr('aria-expanded', 'false');\n        openMenu = null;\n        abortClose();\n        openTime = null;\n    }\n\n    /**\n     * Closes a menu with delay.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function closeWithDelay(menuItem) {\n        closeTimeoutId = setTimeout(close, closeDelay, menuItem);\n    }\n\n    /**\n     * Aborts the delayed closing of {@link openMenu}\n     */\n    function abortClose() {\n        if (closeTimeoutId) {\n            clearTimeout(closeTimeoutId);\n            closeTimeoutId = null;\n        }\n    }\n\n    /**\n     * Aborts the delayed opening of {@link openCandidate}\n     */\n    function abortOpen() {\n        openCandidate = null;\n        if (openTimeoutId) {\n            clearTimeout(openTimeoutId);\n            openTimeoutId = null;\n        }\n    }\n\n    $('li.main-menu-item[aria-haspopup=\"true\"] > a, li#user-menu[aria-haspopup=\"true\"] > a').click((ev) => {\n        if (ev.currentTarget.parentNode === openMenu) {\n            if (new Date() - openTime > closeCooldown) {\n                close(openMenu);\n            }\n        } else {\n            open(ev.currentTarget.parentNode);\n        }\n    });\n\n    let menuitems = $('li.main-menu-item[aria-haspopup=\"true\"], li#user-menu[aria-haspopup=\"true\"]');\n    menuitems.mouseenter((ev) => {\n        if (ev.currentTarget === openMenu) {\n            abortClose();\n        } else {\n            openWithDelay(ev.currentTarget);\n        }\n    });\n    menuitems.mouseleave((ev) => {\n        if (openCandidate && ev.currentTarget === openCandidate) {\n            abortOpen();\n        }\n        if (openMenu && ev.currentTarget === openMenu) {\n            closeWithDelay(ev.currentTarget);\n        }\n    });\n\n    $('li.sub-menu-item[aria-haspopup=\"true\"] > a, li.sub-sub-menu-item[aria-haspopup=\"true\"] > a').click((ev) => {\n        let node = $(ev.currentTarget.parentNode);\n        node.toggleClass('open');\n        node.attr('aria-expanded', !(node.attr('aria-expanded') === 'true'));\n    });\n}"],"file":"menu.min.js"}